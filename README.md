<h1 align="center"><a href="https://github.com/aminomancer/GoatBots-Card-Watcher"><img src="./resources/goat.svg" height="72em"/></a><br>GoatBots Card Watcher<br><sub><a href="https://github.com/aminomancer/GoatBots-Card-Watcher/raw/main/goatbotsCardWatcher.user.js" title="Install with script manager" aria-label="Install with script manager"><img src="./resources/download.png" alt="Download" height="32"></a></sub>
</h1>

Automatically refresh a [GoatBots](https://www.goatbots.com) page on a set timer, check if any of the cards specified by name in the settings are in stock, and if so, add them to cart, play an audio alert, and (optionally) start delivery. This is mainly useful if you're trying to buy new cards that are extremely rare and in high demand. Other players may beat you to the punch if you just manually check every few minutes. That's what motivated me to write this script. I was trying to buy the full-art promos from Double Masters 2022 and other people kept beating me to the draw. So, I made a script to watch the stock for me and give me a head start when a rare card comes into stock.

## Configuration

Configure the script by adding a pathname for a GoatBots page you want to scan, such as `https://www.goatbots.com/set/kaldheim`. When you navigate to that page, the script will automatically reload it on a timer to check if any cards on your list is in stock. When a card on your list is detected, an audio alert will play and the card(s) will be added to your cart. You can scan as many pages as you want, and you can scan for as many cards per-page as you want. Each page in your watchlist has its own cards list in your user settings, so they won't get mixed up.

The alert will play synthesized speech of the names of the new cards, as long as at least one text-to-speech voice is available in your computer operating system. Otherwise it will just play a predefined sound file that says "New cards in stock." The sounds in this script are encoded directly in the script, so it doesn't download anything.

When you first open a GoatBots page, open the script manager popup and click `Add page to watchlist...` to make a watchlist editor appear. The top text field is the path field. It defaults to the path of the current page. If you want to still be able to use the normal GoatBots page without it constantly reloading, add a `+` at the end of the page URL, like in the page paths for the example watchlist (`https://www.goatbots.com/set/kaldheim+` for example). You can navigate to the URL just fine with a + at the end, and the script will correctly recognize it as a different URL. Then, the script will only activate when you explicitly navigate to the + version of the URL, which you can bookmark.

Then proceed to the big text area — the cards list. You can manually enter in the card names you want to add, as they appear on the page, separated by line breaks. Or you can click the `Select by clicking` button at the bottom. This will allow you to add cards to the watchlist just by clicking them. Clicking a card row will toggle it on or off. Then click the `Confirm` button to return to the watchlist editor — the cards list will now be filled with the cards you selected. Then, click the `Save` button and it will store this in your script settings. They will persist even after updating the script.

Names must match the names on GoatBots precisely. By default, this will refresh the page every 10 seconds, provided the tab the page is loaded in is not active. It basically pauses refreshing while the tab is active, so that you can still use the page as normal. That way, it will only scan in the background, and alert you when it finds something. However, this pausing behavior can be disabled by setting `Refresh while active` to true in the advanced settings, which can be accessed through your script manager. I recommend [Violentmonkey](https://violentmonkey.github.io/), which lets you edit scripts in its main page. Open this script in the script editor, and click the `Values` tab. You can set the values of any of the settings in that interface, including the watchlist.

The `Automatically start delivery` setting lets you begin delivery as soon as new cards are detected. This increases the chances that you'll get the cards, since there's no risk of fumbling around trying to find the tab and click the "start delivery" button yourself. The script will just handle it for you. But if you're going to use this, you have to make sure the script isn't operating when you're away from the computer, since it will be a major public nuisance if you're not actually present to conduct the delivery.

You can toggle this setting from the script manager's popup or the script values page. The setting is useful since it takes a few minutes for GoatBots to actually send a trade request. So there's time for you to get ready. You just want to make sure you enter the delivery queue as soon as possible, so that someone else doesn't queue up first. If you're first in line, I think it's guaranteed you'll get the card. For additional efficiency, when the delivery is finished, the script will automatically go back to the page it was watching before it started delivery.

If you're using Firefox and you want the text-to-speech alerts, make sure the pref `media.webspeech.synth.enabled` is enabled in about:config. If you don't want or can't use text-to-speech, and the default sound file is not to your liking, you can replace it with your own base64-encoded audio file. You can convert any mp3 file to base64 by uploading it to [this encoder](https://codepen.io/xewl/pen/NjyRJx). Then just copy the resulting string and replace the `Voice audio file` at the bottom of the script with your new string. The script will decode and play it at runtime. This audio file is not a user setting because that would slow the script down, so you have to edit the script directly.

Before the synthesized speech or voice audio plays, the script will also trigger a little alert sound. This is done so that the alert will be more noticeable in the event that you're listening to dialogue when the alert goes off. The synthesized speech may not be as noticeable if there are other voices playing in the background, so I added a little "ding" noise to play at the same time. It's the same sound that plays when you get a notification in MTGO. This sound can also be changed. Again, it's a base64-encoded audio file, so use the same encoder as above. Aside from that, there are a few other speech/audio settings.

If you are confused about how to use this script, I recommend reading the code comments in the script itself, especially the default setting values near the bottom of the script. And you might want to familiarize yourself with your script manager so you understand how its user settings storage system works and how to use it.

<sub>I am not affiliated with <a href="https://company.wizards.com">Wizards of the Coast</a> or <a href="https://www.goatbots.com">GoatBots</a>. Magic: The Gathering, MTGO, its corresponding symbols, and illustrations are trademarked by Wizards of the Coast. GoatBots and its corresponding symbols and illustrations are trademarked by GoatBots.</sub>